{"version":3,"sources":["../src/index.ts","../src/bbcode.ts"],"sourcesContent":["import { getInput } from \"@actions/core\";\r\nimport path from \"path\";\r\nimport os from \"os\";\r\nimport * as steam from \"./steam.js\";\r\nimport * as gmad from \"./gmad.js\";\r\nimport * as bbcode from \"./bbcode.js\";\r\n\r\nasync function run() {\r\n    const username = getInput('username', { required: true, trimWhitespace: true });\r\n    const password = getInput('password', { trimWhitespace: true });\r\n    const totp = getInput('totp', { trimWhitespace: true });\r\n    const vdf = getInput('vdf');\r\n\r\n    if (!password && !totp && !vdf) {\r\n        throw new Error('No login method provided');\r\n    }\r\n\r\n    const id = getInput('id', { required: false, trimWhitespace: true });\r\n\r\n    const title = getInput('title', { trimWhitespace: true });\r\n    const icon = getInput('icon', { trimWhitespace: true });\r\n\r\n    const description = getInput('description', { trimWhitespace: false });\r\n    const markdownDescription = getInput('markdown-description');\r\n\r\n    if (description && markdownDescription) {\r\n        throw new Error('Cannot provide both description and markdown-description');\r\n    }\r\n\r\n    let realDescription = description;\r\n    if (!description && markdownDescription) {\r\n        realDescription = await bbcode.convert(markdownDescription);\r\n    }\r\n\r\n    const visibility = getInput('visibility', { trimWhitespace: true });\r\n\r\n    const changelog = getInput('changelog');\r\n    const markdownChangelog = getInput('markdown-changelog');\r\n\r\n    let realChangelog = changelog;\r\n    if (!changelog && markdownChangelog) {\r\n        realChangelog = await bbcode.convert(markdownChangelog);\r\n    }\r\n\r\n    if (changelog && markdownChangelog) {\r\n        throw new Error('Cannot provide both changelog and markdown-changelog');\r\n    }\r\n\r\n    const dir = getInput('folder', { required: true });\r\n\r\n    console.log('Downloading SteamCMD...');\r\n    await steam.download();\r\n    console.log('Updating SteamCMD...');\r\n    await steam.update();\r\n    console.log('Logging in to Steam...');\r\n    await steam.login(username, { password, totp, vdf });\r\n\r\n    console.log('Downloading gmad...');\r\n    await gmad.download();\r\n    console.log('Creating addon...');\r\n    const addon = await gmad.create(dir, path.resolve(os.tmpdir(), 'addon', 'addon.gma'));\r\n    const folder = path.dirname(addon);\r\n\r\n    console.log('Publishing addon...');\r\n    await steam.publish(username, {\r\n        id,\r\n        appid: \"4000\",\r\n        changelog: realChangelog,\r\n        icon,\r\n        folder,\r\n        title,\r\n        description: realDescription,\r\n        visibility: parseInt(visibility),\r\n    });\r\n\r\n    console.log('Done!');\r\n}\r\n\r\nrun();\r\n","import { Converter } from \"@gmod-workshop/steamdown\";\r\n\r\n/**\r\n * Convert a markdown string to BBCode\r\n * @param markdown The markdown to convert\r\n * @returns The converted BBCode\r\n */\r\nexport async function convert(markdown: string): Promise<string> {\r\n    const converter = new Converter();\r\n\r\n    const bbcode = await converter.convert(markdown);\r\n\r\n    return bbcode\r\n        .replace(/https:\\/\\/github\\.com\\/([^\\/]+\\/[^\\/]+)\\/(issues|pull)\\/(\\d+)/g, '[url=https://github.com/$1/$2/$3]#$3[/url]')\r\n        .trim();\r\n}\r\n"],"mappings":";;;;;;;;;;AAAA,SAAS,gBAAgB;AACzB,OAAO,UAAU;AACjB,OAAO,QAAQ;;;ACFf,SAAS,iBAAiB;AAO1B,eAAsB,QAAQ,UAAmC;AAC7D,QAAM,YAAY,IAAI,UAAU;AAEhC,QAAM,SAAS,MAAM,UAAU,QAAQ,QAAQ;AAE/C,SAAO,OACF,QAAQ,kEAAkE,4CAA4C,EACtH,KAAK;AACd;;;ADRA,eAAe,MAAM;AACjB,QAAM,WAAW,SAAS,YAAY,EAAE,UAAU,MAAM,gBAAgB,KAAK,CAAC;AAC9E,QAAM,WAAW,SAAS,YAAY,EAAE,gBAAgB,KAAK,CAAC;AAC9D,QAAM,OAAO,SAAS,QAAQ,EAAE,gBAAgB,KAAK,CAAC;AACtD,QAAM,MAAM,SAAS,KAAK;AAE1B,MAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,KAAK;AAC5B,UAAM,IAAI,MAAM,0BAA0B;AAAA,EAC9C;AAEA,QAAM,KAAK,SAAS,MAAM,EAAE,UAAU,OAAO,gBAAgB,KAAK,CAAC;AAEnE,QAAM,QAAQ,SAAS,SAAS,EAAE,gBAAgB,KAAK,CAAC;AACxD,QAAM,OAAO,SAAS,QAAQ,EAAE,gBAAgB,KAAK,CAAC;AAEtD,QAAM,cAAc,SAAS,eAAe,EAAE,gBAAgB,MAAM,CAAC;AACrE,QAAM,sBAAsB,SAAS,sBAAsB;AAE3D,MAAI,eAAe,qBAAqB;AACpC,UAAM,IAAI,MAAM,0DAA0D;AAAA,EAC9E;AAEA,MAAI,kBAAkB;AACtB,MAAI,CAAC,eAAe,qBAAqB;AACrC,sBAAkB,MAAa,QAAQ,mBAAmB;AAAA,EAC9D;AAEA,QAAM,aAAa,SAAS,cAAc,EAAE,gBAAgB,KAAK,CAAC;AAElE,QAAM,YAAY,SAAS,WAAW;AACtC,QAAM,oBAAoB,SAAS,oBAAoB;AAEvD,MAAI,gBAAgB;AACpB,MAAI,CAAC,aAAa,mBAAmB;AACjC,oBAAgB,MAAa,QAAQ,iBAAiB;AAAA,EAC1D;AAEA,MAAI,aAAa,mBAAmB;AAChC,UAAM,IAAI,MAAM,sDAAsD;AAAA,EAC1E;AAEA,QAAM,MAAM,SAAS,UAAU,EAAE,UAAU,KAAK,CAAC;AAEjD,UAAQ,IAAI,yBAAyB;AACrC,QAAY,SAAS;AACrB,UAAQ,IAAI,sBAAsB;AAClC,QAAY,OAAO;AACnB,UAAQ,IAAI,wBAAwB;AACpC,QAAY,MAAM,UAAU,EAAE,UAAU,MAAM,IAAI,CAAC;AAEnD,UAAQ,IAAI,qBAAqB;AACjC,QAAWA,UAAS;AACpB,UAAQ,IAAI,mBAAmB;AAC/B,QAAM,QAAQ,MAAW,OAAO,KAAK,KAAK,QAAQ,GAAG,OAAO,GAAG,SAAS,WAAW,CAAC;AACpF,QAAM,SAAS,KAAK,QAAQ,KAAK;AAEjC,UAAQ,IAAI,qBAAqB;AACjC,QAAY,QAAQ,UAAU;AAAA,IAC1B;AAAA,IACA,OAAO;AAAA,IACP,WAAW;AAAA,IACX;AAAA,IACA;AAAA,IACA;AAAA,IACA,aAAa;AAAA,IACb,YAAY,SAAS,UAAU;AAAA,EACnC,CAAC;AAED,UAAQ,IAAI,OAAO;AACvB;AAEA,IAAI;","names":["download"]}